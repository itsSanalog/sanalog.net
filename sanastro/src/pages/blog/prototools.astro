---
import { getEntry } from "astro:content";
import BlogLayout from "../../layouts/BlogLayout.astro";
---

<!-- IMPORTANT: this file overwrites /blog/tools that would have been generated by [...slug].astro, or at least i think it does. -->

<BlogLayout title="Tools">
  <div class="desk-container" id="desk-container">
    <div class="zoom-controls">
      <button class="zoom-btn" id="zoom-in">+</button>
      <button class="zoom-btn" id="zoom-out">âˆ’</button>
    </div>
    <div class="item-info" id="item-info">
      <h4 id="item-title">name</h4>
      <p id="item-description">description</p>
    </div>
    <div class="desk-surface" id="desk-surface">
    </div>
  </div>
</BlogLayout>



<style>
  .desk-container {
    width: 100%;
    height: 90vh;
    position: relative;
    cursor: grab;
    overflow: hidden;
    background: beige;
  }

  .desk-container:active {
    cursor: grabbing;
  }

  .desk-surface {
    background-color: aqua;

    position: absolute;
    width: 1200px;
    height: 800px;
    transform-origin: center center;
    /* transition: transform 0.1s ease; */
  }

  :global(.desk-item) { 
    position: absolute;
    cursor: pointer;
    transition: all 0.1s ease;
  }

  :global(.desk-item:hover) {
    transform: translateY(-5px) scale(1.05);
    filter: drop-shadow(4px 4px 8px rgb(0, 0, 0));
    stroke:var(--color-action);
    stroke-width: 3;
  }

  :global(.desk-item svg) {
    width: 100%;
    height: 100%;
    stroke:var(--color-tx-normal);
    stroke-width: 2;
  }

  .item-info {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 100;
    background: rgba(0,0,0,0.7);
    padding: 15px;
    border-radius: 10px;
    backdrop-filter: blur(10px);
    opacity: 0;
    transition: opacity 0.1s ease;
  }

  .item-info.visible {
    opacity: 1;
  }

  .zoom-controls {
    position: absolute;
    top: 2rem;
    right: 2rem;
    z-index: 100;
    display: flex;
    flex-direction: column;
    gap: 0.3em;
  }

  .zoom-btn {
    width: 4rem;
    height: 4rem;
    background: var(--color-ui-normal);
    border: none;
    border-radius: 50%;
    color: var(--color-tx-normal);
    font-size: 2rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.1s ease;
  }

  .zoom-btn:hover {
    background: var(--color-ui-hover);
    color: var(--color-action);
  }
</style>



<script>
  const deskItemsConfig = [
    {
      id: 1,
      name: "knife",
      description: "knife",
      x: 440, y: 410, width: 150, height: 120,
      svgFile: "knife.svg"
    },
    {
      id: 2,
      name: "phone",
      description: "phone",
      x: 280, y: 340, width: 250, height: 160,
      svgFile: "phone.svg"
    },
    {
      id: 3,
      name: "switch",
      description: "switch",
      x: 450, y: 180, width: 340, height: 300,
      svgFile: "switch.svg"
    }
  ];

  async function loadDeskItems() {
    const basePath = "/images/toolvectors/";
    const items = await Promise.all(
      deskItemsConfig.map(async (item) => {
        const res = await fetch(basePath + item.svgFile);
        const svg = await res.text();
        return { ...item, svg };
      })
    );
    return items;
  }

  class IsometricDesk {
    constructor(deskItems) {
      this.deskItems = deskItems;
      this.container = document.getElementById('desk-container');
      this.surface = document.getElementById('desk-surface');
      this.itemInfo = document.getElementById('item-info');

      this.scale = 1;
      this.translateX = 0;
      this.translateY = 0;
      this.isDragging = false;
      this.lastMouseX = 0;
      this.lastMouseY = 0;
      
      this.init();
    }
      
    init() {
      this.createItems();
      this.bindEvents();
      this.centerView();
    }
      
    createItems() {
      this.deskItems.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.classList.add('desk-item');
        itemElement.style.left = item.x + 'px';
        itemElement.style.top = item.y + 'px';
        itemElement.style.width = item.width + 'px';
        itemElement.style.height = item.height + 'px';
        itemElement.innerHTML = item.svg;
        itemElement.dataset.itemId = item.id;
      
        // const svg = itemElement.querySelector('svg');
        // if (svg) {
        //   svg.classList.add('gay');
        // }

        // Add hover events for item info
        itemElement.addEventListener('mouseenter', () => {
          document.getElementById('item-title').textContent = item.name;
          document.getElementById('item-description').textContent = item.description;
          this.itemInfo.classList.add('visible');
        });
        
        itemElement.addEventListener('mouseleave', () => {
          this.itemInfo.classList.remove('visible');
        });
        
        itemElement.addEventListener('click', () => {
          this.focusOnItem(item);
        });
        
        this.surface.appendChild(itemElement);
      });
    }
      
    bindEvents() {
      // Mouse events for panning
      this.container.addEventListener('mousedown', (e) => {
        this.isDragging = true;
        this.lastMouseX = e.clientX;
        this.lastMouseY = e.clientY;
      });
      
      document.addEventListener('mousemove', (e) => {
        if (this.isDragging) {
          const deltaX = e.clientX - this.lastMouseX;
          const deltaY = e.clientY - this.lastMouseY;
          
          this.translateX += deltaX;
          this.translateY += deltaY;
          
          this.updateTransform();
          
          this.lastMouseX = e.clientX;
          this.lastMouseY = e.clientY;
        }
      });
        
      document.addEventListener('mouseup', () => {
        this.isDragging = false;
      });
      
      // Scroll for zooming
      this.container.addEventListener('wheel', (e) => {
        e.preventDefault();
        const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
        this.zoom(zoomFactor);
      });
      
      // Zoom buttons
      document.getElementById('zoom-in').addEventListener('click', () => {
        this.zoom(1.2);
      });
      
      document.getElementById('zoom-out').addEventListener('click', () => {
        this.zoom(0.8);
      });
    }
      
    zoom(factor) {
      const newScale = this.scale * factor;
      if (newScale >= 0.3 && newScale <= 3) {
        this.scale = newScale;
        this.updateTransform();
      }
    }
    
    updateTransform() {
      this.surface.style.transform = `translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`;
    }
  
    centerView() {
      const containerRect = this.container.getBoundingClientRect();
      this.translateX = (containerRect.width - 1200) / 2;
      this.translateY = (containerRect.height - 800) / 2;
      this.updateTransform();
    }
    
    resetView() {
      this.scale = 1;
      this.centerView();
    }
    
    focusOnItem(item) {
      const itemCenterX = item.x + item.width / 2;
      const itemCenterY = item.y + item.height / 2;
      
      this.translateX = window.innerWidth / 2 - itemCenterX * this.scale;
      this.translateY = window.innerHeight / 2 - itemCenterY * this.scale;
      
      this.updateTransform();
    }
  }
  
  window.addEventListener('load', async () => {
    const deskItems = await loadDeskItems();
    new IsometricDesk(deskItems);
  });
</script>